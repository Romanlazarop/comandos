--crear tablas

CREATE TABLE CUSTOMERS( 
CLIENTE_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
NOMBRE NVARCHAR2(15),
FECHA_NAC DATE,
DOMICILIO NVARCHAR2(40)
);

CREATE TABLE EMPLEADOS(
EMPLEADO_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
NOMBRE NVARCHAR2(15),
FECHA_INGRESO DATE,
SALARIO NUMBER(5,2)
);

CREATE TABLE PROVEEDOR(
PROVEEDOR_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
NOMBRE NVARCHAR2(30),
TELEFONO NVARCHAR2(10),
CORREO NVARCHAR2(20)
);

CREATE TABLE PRODUCTOS(
PRODUCTO_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
DEPTO_ID NUMBER,
NOMBRE NVARCHAR2(20),
FECHA_CAD DATE,
PRECIO_COMPRA NUMBER(5,2),
PRECIO_VENTA NUMBER(5,2),
REFRIGERADO CHAR(1),
CONSTRAINT CHECK_REFRIGERADO CHECK (REFRIGERADO IN('Y','N'))
);

CREATE TABLE VENTAS(
VENTA_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
EMPLEADO_ID NUMBER,
CLIENTE_ID NUMBER,
FECHA_VENTA DATE,
SUBTOTAL NUMBER(5,2),
TOTAL NUMBER(5,2)
);

CREATE TABLE INVENTARIO(
INVENTARIO_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
PRODUCTO_ID NUMBER,
STOCK NUMBER,
FECHA DATE
);

CREATE TABLE PROD_PROV(
PROD_PROV_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
PROVEEDOR_ID NUMBER,
PRODUCTO_ID NUMBER
);

CREATE TABLE DET_VENTA(
DET_VENTA_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
VENTA_ID NUMBER,
PRODUCTO_ID NUMBER,
CANTIDAD NUMBER
);

CREATE TABLE DEPARTAMENTO(
DEPTO_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
EMPLEADO_ID NUMBER,
NOMBRE NVARCHAR2(20)
);

--crear llaves

ALTER TABLE VENTAS ADD CONSTRAINT FK_VENTAS_CLIENTE_ID
FOREIGN KEY (CLIENTE_ID) 
REFERENCES CUSTOMERS(CLIENTE_ID);

ALTER TABLE VENTAS ADD CONSTRAINT FK_VENTAS_EMPLEADO_ID
FOREIGN KEY (EMPLEADO_ID) 
REFERENCES EMPLEADOS(EMPLEADO_ID);

ALTER TABLE DET_VENTA ADD CONSTRAINT FK_DET_VENTA_VENTA_ID
FOREIGN KEY (VENTA_ID) 
REFERENCES VENTAS(VENTA_ID);

ALTER TABLE  PRODUCTOS  ADD CONSTRAINT FK__PRODUCTOS_DEPTO_ID
FOREIGN KEY (DEPTO_ID) 
REFERENCES DEPARTAMENTO(DEPTO_ID);

ALTER TABLE PROD_PROV ADD CONSTRAINT FK_PROD_PROV_PRODUCTO_ID
FOREIGN KEY (PRODUCTO_ID) 
REFERENCES PRODUCTOS(PRODUCTO_ID);


ALTER TABLE PROD_PROV ADD CONSTRAINT FK_PROD_PROV_PROVEEDOR_ID
FOREIGN KEY (PROVEEDOR_ID) 
REFERENCES PROVEEDOR(PROVEEDOR_ID);


ALTER TABLE INVENTARIO ADD CONSTRAINT FK_INVENTARIO_PRODUCTO_ID
FOREIGN KEY (PRODUCTO_ID) 
REFERENCES PRODUCTOS(PRODUCTO_ID);


ALTER TABLE DEPARTAMENTO ADD CONSTRAINT FK_DEPARTAMENTO_EMPLEADO_ID
FOREIGN KEY (EMPLEADO_ID) 
REFERENCES EMPLEADOS(EMPLEADO_ID);


ALTER TABLE DET_VENTA ADD CONSTRAINT FK_DET_VENTA_PRODUCTO_ID
FOREIGN KEY (PRODUCTO_ID) 
REFERENCES PRODUCTOS(PRODUCTO_ID);

--TABLA PROVEEDORES
INSERT INTO PROVEEDOR (NOMBRE, TELEFONO, CORREO) VALUES ('COCA-COLA', '2227465896', 'cocacola@gmail.com');
INSERT INTO PROVEEDOR (NOMBRE, TELEFONO, CORREO) VALUES ('NESTLE', '2222736450', 'nestle@gmail.com');
INSERT INTO PROVEEDOR (NOMBRE, TELEFONO, CORREO) VALUES ('PEPSICO', '2225346354', 'pepsico@gmail.com');
INSERT INTO PROVEEDOR (NOMBRE, TELEFONO, CORREO) VALUES ('DANONE', '2227589009', 'danone@gmail.com');
INSERT INTO PROVEEDOR (NOMBRE, TELEFONO, CORREO) VALUES ('KELLUGGS', '2220013645', 'kelluggs@gmail.com');

-- INSERTS CUSTOMER
INSERT INTO CUSTOMERS(NOMBRE,FECHA_NAC,DOMICILIO)
VALUES('Angel Perez', '10/01/2020', 'Avenida 10 Poniente');
INSERT INTO CUSTOMERS(NOMBRE,FECHA_NAC,DOMICILIO)
VALUES('Manuel Sanchez', '01/02/2020', 'Calle Flores 5');
INSERT INTO CUSTOMERS(NOMBRE,FECHA_NAC,DOMICILIO)
VALUES('Maria Garcia', '05/03/2020', 'Avenida 20 Oriente');
INSERT INTO CUSTOMERS(NOMBRE,FECHA_NAC,DOMICILIO)
VALUES('Rodrigo Lopez', '20/04/2020', 'Avenida Centenario 10');
INSERT INTO CUSTOMERS(NOMBRE,FECHA_NAC,DOMICILIO)
VALUES('Monica Gonzalez', '15/06/2021', 'Calle independencia 12');

--TABLA EMPLEADOS: 

INSERT INTO EMPLEADOS (NOMBRE, FECHA_INGRESO, SALARIO) VALUES ('ALEX QUIJANO', '13/02/2015', 300.00);
INSERT INTO EMPLEADOS (NOMBRE, FECHA_INGRESO, SALARIO) VALUES ('FERNANDO CHAVEZ', '23/08/2018', 500.00);
INSERT INTO EMPLEADOS (NOMBRE, FECHA_INGRESO, SALARIO) VALUES ('ERICK JOSE MAZA', '20/10/2020', 250.00);
INSERT INTO EMPLEADOS (NOMBRE, FECHA_INGRESO, SALARIO) VALUES ('ANTONIO BARRERA', '15/03/2016', 600.00);
INSERT INTO EMPLEADOS (NOMBRE, FECHA_INGRESO, SALARIO) VALUES ('RENE GARCIA', '09/12/2019', 299.00);
 SELECT *FROM EMPLEADOS;
 DESCRIBE PRODUCTOS;
INSERT INTO DEPARTAMENTO(EMPLEADO_ID,NOMBRE)
VALUES(1,'VENTAS');
INSERT INTO DEPARTAMENTO(EMPLEADO_ID,NOMBRE)
VALUES(2,'INVENTARIO');
INSERT INTO DEPARTAMENTO(EMPLEADO_ID,NOMBRE)
VALUES(3,'LIMPIEZA');
INSERT INTO DEPARTAMENTO(EMPLEADO_ID,NOMBRE)
VALUES(5,'SISTEMAS');
INSERT INTO DEPARTAMENTO(EMPLEADO_ID,NOMBRE)
VALUES(4,'ENCARGADOS');
INSERT INTO DEPARTAMENTO(EMPLEADO_ID,NOMBRE)

SELECT*FROM PRODUCTOS;
INSERT INTO PRODUCTOS (DEPTO_ID, NOMBRE, FECHA_CAD, PRECIO_COMPRA,PRECIO_VENTA,
REFRIGERADO) VALUES(1, 'COCA-COLA', '06/SEP/2024', '120.00',
'250.00', 'Y'); 
INSERT INTO PRODUCTOS (DEPTO_ID, NOMBRE, FECHA_CAD, PRECIO_COMPRA,PRECIO_VENTA,
REFRIGERADO) VALUES(1, 'LECHERA', '25/SEP/2024', '80.00',
'200.00', 'Y'); 
INSERT INTO PRODUCTOS (DEPTO_ID, NOMBRE, FECHA_CAD, PRECIO_COMPRA,PRECIO_VENTA,
REFRIGERADO) VALUES(1, 'PEPSI', '09/SEP/2024', '40.00',
'150.00', 'Y'); 
INSERT INTO PRODUCTOS (DEPTO_ID, NOMBRE, FECHA_CAD, PRECIO_COMPRA,PRECIO_VENTA,
REFRIGERADO) VALUES(1, 'YOGURTH', '16/OCT/2024', '900.00',
'180.00', 'N'); 
INSERT INTO PRODUCTOS (DEPTO_ID, NOMBRE, FECHA_CAD, PRECIO_COMPRA,PRECIO_VENTA,
REFRIGERADO) VALUES(1, 'CEREALES', '19/SEP/2024', '15.00',
'75.50', 'N');

SELECT * FROM VENTAS;
DESCRIBE VENTAS;
INSERT INTO VENTAS (EMPLEADO_ID, CLIENTE_ID, FECHA_VENTA, SUBTOTAL, TOTAL) VALUES (1, 1, '02/08/2000', 500.00, 789.26);
INSERT INTO VENTAS (EMPLEADO_ID, CLIENTE_ID, FECHA_VENTA, SUBTOTAL, TOTAL) VALUES (2, 2, '18/06/2001', 506.63, 984.63);
INSERT INTO VENTAS (EMPLEADO_ID, CLIENTE_ID, FECHA_VENTA, SUBTOTAL, TOTAL) VALUES (3, 3, '20/02/2002', 505.45, 623.42);
INSERT INTO VENTAS (EMPLEADO_ID, CLIENTE_ID, FECHA_VENTA, SUBTOTAL, TOTAL) VALUES (4, 4, '31/07/2003', 742.02, 123.10);
INSERT INTO VENTAS (EMPLEADO_ID, CLIENTE_ID, FECHA_VENTA, SUBTOTAL, TOTAL) VALUES (5, 5, '16/10/2018', 984.78, 789.36);

INSERT INTO DET_VENTA (VENTA_ID, PRODUCTO_ID, CANTIDAD) VALUES (6, 1, 6000); 
INSERT INTO DET_VENTA (VENTA_ID, PRODUCTO_ID, CANTIDAD) VALUES (8, 2, 4521);
INSERT INTO DET_VENTA (VENTA_ID, PRODUCTO_ID, CANTIDAD) VALUES (9, 3, 7896);
INSERT INTO DET_VENTA (VENTA_ID, PRODUCTO_ID, CANTIDAD) VALUES (10, 4,4785);
INSERT INTO DET_VENTA (VENTA_ID, PRODUCTO_ID, CANTIDAD) VALUES (7, 5, 9874);

INSERT INTO INVENTARIO (PRODUCTO_ID, STOCK, FECHA) VALUES(1, '100',
'01/SEP/2024');
INSERT INTO INVENTARIO (PRODUCTO_ID, STOCK, FECHA) VALUES(2, '100',
'01/SEP/2024');
INSERT INTO INVENTARIO (PRODUCTO_ID, STOCK, FECHA) VALUES(3, '500',
'01/SEP/2024');
INSERT INTO INVENTARIO (PRODUCTO_ID, STOCK, FECHA) VALUES(4, '12',
'01/SEP/2024');
INSERT INTO INVENTARIO (PRODUCTO_ID, STOCK, FECHA) VALUES(5, '40',
'01/SEP/2024');

SELECT * FROM PRODUCTOS;
SELECT * FROM PROVEEDOR;
INSERT INTO PROD_PROV(PROVEEDOR_ID,PRODUCTO_ID) VALUES(1,1);
INSERT INTO PROD_PROV(PROVEEDOR_ID,PRODUCTO_ID) VALUES(2,2);
INSERT INTO PROD_PROV(PROVEEDOR_ID,PRODUCTO_ID) VALUES(3,3);
INSERT INTO PROD_PROV(PROVEEDOR_ID,PRODUCTO_ID) VALUES(4,4);
INSERT INTO PROD_PROV(PROVEEDOR_ID,PRODUCTO_ID) VALUES(5,5);

--QUE QUIERES,DE DONDE,CONDICIONES

SELECT *FROM PRODUCTOS;
SELECT NOMBRE,PRECIO_COMPRA FROM PRODUCTOS WHERE FECHA_CAD <'01/10/2024';
SELECT PRECIO_COMPRA,NOMBRE,FECHA_CAD FROM PRODUCTOS WHERE FECHA_CAD <'01/10/2024' AND REFRIGERADO = 'Y';
SELECT PRECIO_COMPRA,NOMBRE,FECHA_CAD FROM PRODUCTOS WHERE FECHA_CAD <'01/10/2024' OR REFRIGERADO = 'Y';

SELECT *FROM EMPLEADOS WHERE SALARIO <> 600;
SELECT *FROM EMPLEADOS WHERE NOT SALARIO =600;

SELECT NOMBRE FROM EMPLEADOS WHERE SALARIO >=200 AND SALARIO <=500;
SELECT NOMBRE FROM EMPLEADOS WHERE SALARIO BETWEEN 200 AND 500;
COMMIT;
DESCRIBE PRODUCTOS;
SELECT*FROM PRODUCTOS;
--------------FUNCIONES DE AGREGACION-----------------

--BUSCAR EL PRODUCTO MAS CARO
SELECT *FROM PRODUCTOS WHERE PRECIO_VENTA =(SELECT MAX(PRECIO_VENTA) FROM PRODUCTOS);
--BUCAR EL PRODUCTO MAS BARATO 
SELECT *FROM PRODUCTOS WHERE PRECIO_VENTA =(SELECT MIN(PRECIO_VENTA) FROM PRODUCTOS);
--CALCULA LA SUMATORIA DE TODOS LOS PRECIOS DE LOS PRODUCTOS 
SELECT SUM(PRECIO_COMPRA) AS SUMATORIA FROM PRODUCTOS;
--CALCULA CUANTOS PRODUCTOS SON REFRIGERADO
SELECT COUNT(PRODUCTO_ID) AS CONTADOR FROM PRODUCTOS WHERE REFRIGERADO='Y';
SELECT COUNT(PRODUCTO_ID) FROM PRODUCTOS WHERE PRECIO_COMPRA >600;

--CALCULAR PROMEDIO DE LOS PRECIOS DE LOS PRODUCTOS 
SELECT AVG(PRECIO_COMPRA) FROM PRODUCTOS;


--BUSCAR LOS PRODUCTOS SURTIDO POR EL PROVEEDOR NESTLE
SELECT * FROM PRODUCTOS WHERE PRODUCTO_ID=(SELECT PRODUCTO_ID FROM PROD_PROV WHERE PROVEEDOR_ID =(SELECT PROVEEDOR_ID FROM PROVEEDOR WHERE  NOMBRE ='NESTLE'));
--BUSCAR EL  INVENTARIO DE TODOS LOS PRODUCTOS REFRIGERADOS
SELECT * FROM INVENTARIO WHERE PRODUCTO_ID IN (SELECT PRODUCTO_ID FROM PRODUCTOS WHERE REFRIGERADO='Y');
SELECT * FROM EMPLEADOS;
--CONTAR CUANTAS VENTAS HA TENIDO EL EMPLEADO 'RENE GARCIA'
SELECT COUNT(VENTA_ID) FROM VENTAS WHERE EMPLEADO_ID = (SELECT EMPLEADO_ID FROM EMPLEADOS WHERE NOMBRE ='RENE GARCIA');
SELECT * FROM DEPARTAMENTO;
--CALCULAR EL PROMEDIO DE LOS PRECIOS_COMPRAS DE LOS PRODUCTO DEL DEPARTAMENTO
SELECT AVG(PRECIO_COMPRA)FROM PRODUCTOS WHERE DEPTO_ID =(SELECT DEPTO_ID FROM DEPARTAMENTO WHERE NOMBRE ='VENTAS');


SELECT*FROM PRODUCTOS;
-- MOSTRAR LOS DATOS ORDENADOS
SELECT*FROM PRODUCTOS ORDER BY NOMBRE DESC;

-- IDENTIFICAR GRUPOS DE DATOS EN COMUN
SELECT COUNT(PRODUCTO_ID), REFRIGERADO FROM PRODUCTOS GROUP BY REFRIGERADO;


-- NOMBRE, PRECI_COMPRA , REFRIGERADO, STOCK, FECHA

-- PRODUCTOS P
-- INVENTARIO I

SELECT D.NOMBRE AS DEPTO, P.NOMBRE AS PRODUCTO, P.PRECIO_COMPRA, P.REFRIGERADO,I.STOCK, I.FECHA
FROM PRODUCTOS P INNER JOIN INVENTARIO I
ON P.PRODUCTO_ID = I.PRODUCTO_ID
INNER JOIN DEPARTAMENTO D
ON D.DEPTO_ID = P.DEPTO_ID WHERE P.REFRIGERADO = 'Y';


--
SELECT D.NOMBRE AS DEPTO, P.NOMBRE AS PRODUCTO, P.PRECIO_VENTA
FROM DEPARTAMENTO D INNER JOIN PRODUCTOS P 
ON D.DEPTO_ID = P.DEPTO_ID WHERE P.PRECIO_VENTA=(SELECT MAX (PRECIO_VENTA) FROM PRODUCTOS ); 
COMMIT;
SELECT *FROM EMPLEADOS;
DESCRIBE EMPLEADOS;
SELECT * FROM EMPLEADOS WHERE EMPLEADO_ID= 21;
SELECT *FROM CUSTOMERS;



